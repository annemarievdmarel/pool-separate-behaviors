---
title: "Visualizing results"
author: "Annemarie"
date: "01/06/2020"
output: html_document
---

Comparison of real vs randomized data in 4-6 plots:
- correlation crowds vs displacements
Individual-based measures
- outstrength
- eigenvector centrality
Hierarchy structure
- linearity
- steepness
- transitivity
Network-based measures
- density
- sparseness
Aggression pattern
- strategies

# load packages
```{r setup, include=FALSE}
library(beanplot)
library(scales)
library(ggplot2)
library(dplyr)
library(ggpubr)

```

# Import data
```{r}
# summaries
observed.summary <- read.csv("ANALYZE-SUMM.observed.csv")
head(observed.summary)
observed.summary.individual<- read.csv("ANALYZE-SUMM.observed.individual.csv")
observed.ID<-rename(observed.summary.individual, ID = X)

refmodel1.summary<- read.csv("ANALYZE-SUMM.refmodel1.csv")  # reference model 1
refmodel1.summary<- separate(refmodel1.summary, X, c("ID", "no."), sep = 3) %>% select(-no.)
head(refmodel1.summary)
refmodel1.summary.group <- refmodel1.summary %>% group_by(run.code) %>% slice(1) 

refmodel2.summary<-read.csv("ANALYZE-SUMM.refmodel2.csv") # reference model 2
refmodel2.summary<- separate(refmodel2.summary, X, c("ID", "no."), sep = 3) %>% select(-no.)
head(refmodel2.summary)
refmodel2.summary.group <- refmodel2.summary %>% group_by(run.code) %>% slice(1) 

# reference model strategies
refmodel1.strategies <- read.csv("ANALYZE_SUMM.refmodel.strategies.csv") 
str(refmodel1.strategies)
refmodel2.strategies<- read.csv("ANALYZE_SUMM.sparse.refmodel.strategies.csv") %>%
  rename(focus.sparse = focus.Rdisp, 
         position.sparse = position.Rdisp, 
         strategy.sparse = strategy.Rdisp) %>% 
  select(-X)
str(refmodel2.strategies)

ref.model.strategies<-left_join(refmodel1.strategies, refmodel2.strategies, by="run.code")
head(ref.model.strategies)

```

#### Distribution plots

set color and other parameters
```{r}
# set color and other parameters
col.teal <- "#1f78b4" #use for crowds
col.ltgn <- "#b2df8a" #use for sparse displace
col.dkgn <- "#33a02c" #use for regular displace
col.lttl <- "#a6cee3"
col.dkrd <- "#ca0020"


#set color by behavior
crowds <- col.teal
displace <- col.dkgn
obs.vals <- col.dkrd

#set plot color by plot element
bean.alpha <- 0.4


beaninlines <- alpha("black", 0.2)
beanoutlines<- alpha("black", 0.2)
beanavgines <- "purple"
beanborder <- alpha("black", 0.6)

pooled.alpha <- 0.7
linewidth <- 1
xlabels <- c("ref1 crowds", "ref1 displace", "ref2 displace")
obsval.pch <- 5
obsval.size <- 2.5
obsval.hlt.pch <- 8  # asterisk  --> significant result
obsval.hlt.pch.plus <- 16 # plus ---> non-significant result
obsval.hlt.cex <- 1
ylim<-c(0,1)

```



# correlation
```{r, corr.beans, cache=FALSE, fig.height=4, fig.width=5.75}
# correlation matrix
beanplot(refmodel1.summary.group$ref1.cor.matrix, refmodel2.summary.group$ref2.cor.matrix, 
         main="Correlation matrix between crowds and displacements", 
         ylab="Spearman's rho", 
         xlab = "reference model", 
        # ylim = ,
         las=1, 
         # col = list(c(alpha(displace, bean.alpha), alpha(col.ltgn, bean.alpha)), #fill colors
         #            c(alpha(beaninlines, 0.5), alpha(beaninlines, 0.5)) #bean colors
         #            ),
         
         col = list(c(alpha(displace, bean.alpha), beaninlines, beaninlines, "black"), #bean 1 
                    c(alpha(col.ltgn, bean.alpha), beaninlines, beaninlines, "black") #bean 2
                    ),
         
         border=crowds
         )

abline(h=observed.summary$obs.cor.matrix, col=alpha(obs.vals, pooled.alpha), lwd = linewidth)  # add line estimate of totalDC 

# save plot
dev.print(pdf, file="plot.correlation.beans.pdf")
```

```{r}
# spearman correlation
beanplot(refmodel1.summary.group$run.cor, refmodel2.summary.group$run.cor, 
         main="Correlation between crowds and displacements", 
         ylab="Spearman's rho", 
         xlab = "reference model", 
         ylim = c(min(refmodel2.summary$run.cor-0.1), 
                  max(0.5)),
         las=1, 
         # col = list(c(alpha(displace, bean.alpha), alpha(col.ltgn, bean.alpha)), #fill colors
         #            c(alpha(beaninlines, 0.5), alpha(beaninlines, 0.5)) #bean colors
         #            ),
         
         col = list(c(alpha(displace, bean.alpha), beaninlines, beaninlines, "black"), #bean 1 
                    c(alpha(col.ltgn, bean.alpha), beaninlines, beaninlines, "black") #bean 2
                    ),
         
         border=crowds
         )

abline(h=observed.summary$obs.cor, col=alpha(obs.vals, pooled.alpha), lwd = linewidth)  # add line estimate of totalDC 
```

## individual-based measures


#ggplot - separate plots per ref model
https://drsimonj.svbtle.com/plotting-background-data-for-groups-with-ggplot2
```{r}
bg_refmodel1 <- select(refmodel1.summary, -run.code)
bg_refmodel2 <- select(refmodel2.summary, -run.code)


# out strength
plot.ref1.strength<- ggplot(data = observed.summary.individual, aes(x = Obdisp.strength, y = Obcrowd.strength)) +
  geom_jitter(data = bg_refmodel1, aes(Rdisp.strength, y = Rcrowd.strength), colour = col.dkgn, alpha = bean.alpha) +
  theme_classic() + 
  ggtitle("out strength") +
  xlab("displace") + 
  ylab("crowd") +
  geom_jitter(col=alpha(obs.vals, pooled.alpha))

plot.ref2.strength<- ggplot(data = observed.summary.individual, aes(x = Obdisp.strength, y = Obcrowd.strength)) +
  theme_classic() + 
  ggtitle("out strength") +
  xlab("displace") + 
  ylab("crowd") +
  geom_jitter(data = bg_refmodel2, aes(Rdisp.strength, y = Rcrowd.strength), colour = col.ltgn, alpha = bean.alpha) +
  geom_jitter(col=alpha(obs.vals, pooled.alpha))
plot.ref2.strength

# betweenness
plot.ref1.between<-ggplot(data = observed.summary.individual, aes(x = Obdisp.between, y = Obcrowd.between)) +
  geom_jitter(data = bg_refmodel1, aes(Rdisp.between, y = Rcrowd.between), colour = col.dkgn, alpha = bean.alpha) +
  theme_classic() + 
  ggtitle("betweenness centrality") +
  xlab("displace") + 
  ylab("crowd") +
  geom_jitter(col=alpha(obs.vals, pooled.alpha)) 

plot.ref2.between<-ggplot(data = observed.summary.individual, aes(x = Obdisp.between, y = Obcrowd.between)) +
  theme_classic() + 
  ggtitle("betweenness centrality") +
  xlab("displace") + 
  ylab("crowd") +
  geom_jitter(data = bg_refmodel2, aes(Rdisp.between, y = Rcrowd.between), colour = col.ltgn, alpha = bean.alpha) +
  geom_jitter(col=alpha(obs.vals, pooled.alpha)) 

# eigenvector
plot.ref1.eigen<-ggplot(data = observed.summary.individual, aes(x = Obdisp.ec, y = Obcrowd.ec)) +
  geom_jitter(data = bg_refmodel1, aes(Rdisp.ec, y = Rcrowd.ec), colour = col.dkgn, alpha = bean.alpha) +
  theme_classic() + 
  ggtitle("eigenvector centrality") +
  xlab("displace") + 
  ylab("crowd") +
  geom_jitter(col=alpha(obs.vals, pooled.alpha))
  #geom_text(x=0.85, y=0.75, label="p = ", color="col.dkgn") +
  #geom_text(x=0.85, y=0.65, label="p = ", color="col.ltgn") 

plot.ref2.eigen<-ggplot(data = observed.summary.individual, aes(x = Obdisp.ec, y = Obcrowd.ec)) +
  theme_classic() + 
  ggtitle("eigenvector centrality") +
  xlab("displace") + 
  ylab("crowd") +
  geom_jitter(data = bg_refmodel2, aes(Rdisp.ec, y = Rcrowd.ec), colour = col.ltgn, alpha = bean.alpha) + 
  geom_jitter(col=alpha(obs.vals, pooled.alpha)) 
  #geom_smooth(method=lm, se=FALSE, col = alpha(obs.vals, pooled.alpha)) +
  #geom_smooth(data = bg_refmodel2, aes(x=Rdisp.ec, y=Rcrowd.ec), colour = col.ltgn, alpha = bean.alpha, method = lm, se = FALSE)
  #geom_text(x=0.85, y=0.75, label="p = ", color="col.dkgn") +
  #geom_text(x=0.85, y=0.65, label="p = ", color="col.ltgn") 


plot.ref.indvidual <- ggarrange(plot.ref1.strength,plot.ref1.between, plot.ref1.eigen,plot.ref2.strength,plot.ref2.between, plot.ref2.eigen,
                            nrow = 2, ncol = 3)
plot.ref.indvidual
ggexport(plot.ref.indvidual, filename = "plot.ref.individual.pdf")
```


# Distribution plots of correlation strength ref model 1 and ref model 2 + observed value

```{r}
par(mfrow=c(1,3))

# out strength
beanplot(refmodel1.summary$R.cor.strength, refmodel2.summary$R.cor.strength, 
         main="out-strength", 
         ylab="Spearman's rho", log = "",
         xlab = "",  ylim=c(-0.2, 1.0),
         #add custom bean colorscrowds
           col = list(c(alpha(displace, bean.alpha), beaninlines, beaninlines, "black"), #bean 1 
                    c(alpha(col.ltgn, bean.alpha), beaninlines, beaninlines, "black") #bean 2
                    ),
        
         border = beanborder, 
         las=1, 
         ll = 0.01, beanlinewd = 2,
         cutmin=0, cutmax=1,
         what = c(FALSE, TRUE, TRUE, TRUE)) # remove overall line

abline(h=observed.summary$obs.cor.strength, col=alpha(obs.vals, pooled.alpha), lwd = linewidth)  # add line estimate of totalDC 

# betweenness centrality
beanplot(refmodel1.summary$R.cor.between, refmodel2.summary$R.cor.between, 
         main="betweenness centrality", 
         ylab="Spearman's rho", log = "",
         xlab = "",  ylim=c(-0.2, 1.0),
         #add custom bean colorscrowds
           col = list(c(alpha(displace, bean.alpha), beaninlines, beaninlines, "black"), #bean 1 
                    c(alpha(col.ltgn, bean.alpha), beaninlines, beaninlines, "black") #bean 2
                    ),
        
         border = beanborder, 
         las=1, 
         ll = 0.01, beanlinewd = 2,
         cutmin=0, cutmax=1,
         what = c(FALSE, TRUE, TRUE, TRUE)) # remove overall line

abline(h=observed.summary$obs.cor.between, col=alpha(obs.vals, pooled.alpha), lwd = linewidth)  # add line estimate of totalDC 


# eigenvector centrality
beanplot(refmodel1.summary$R.cor.eigen, refmodel2.summary$R.cor.eigen, 
         main="eigenvector centrality", 
         ylab="Spearman's rho", log = "",
         xlab = "",  ylim=c(-0.2, 1.0),
         #add custom bean colorscrowds
           col = list(c(alpha(displace, bean.alpha), beaninlines, beaninlines, "black"), #bean 1 
                    c(alpha(col.ltgn, bean.alpha), beaninlines, beaninlines, "black") #bean 2
                    )  
         ,
         border = beanborder, 
         las=1, 
         ll = 0.01, beanlinewd = 2,
         cutmin=0, cutmax=1,
         what = c(FALSE, TRUE, TRUE, TRUE)) # remove overall line

abline(h=observed.summary$obs.cor.eigen, col=alpha(obs.vals, pooled.alpha), lwd = linewidth)  # add line estimate of totalDC

# save plot
dev.print(pdf, file="plot.indvidual.cor.beans.pdf")
  

```
Are observed values significantly different from random values in reference models?

find proportion of random values less than the observed values, you can use this as a kind of p value. p should be >0.975 for two-tailed test, >0.95 for one-tailed test for something significantly different from the random values in the reference model
  
```{r}
# p-values 

# out-strength
prop.val <- nrow(refmodel1.summary.group[refmodel1.summary.group$R.cor.strength<observed.summary$obs.cor.strength, ])/nrow(refmodel1.summary.group) 
p.ref1.strength<- ifelse(prop.val>0.5, 1-prop.val, prop.val) 
p.ref1.strength

prop.val <- nrow(refmodel2.summary.group[refmodel2.summary.group$R.cor.strength<observed.summary$obs.cor.strength, ])/nrow(refmodel2.summary.group) 
p.ref2.strength<- ifelse(prop.val>0.5, 1-prop.val, prop.val) 
p.ref2.strength

# betweenness
prop.val <- nrow(refmodel1.summary.group[refmodel1.summary.group$R.cor.between<observed.summary$obs.cor.between, ])/nrow(refmodel1.summary.group) 
p.ref1.between<- ifelse(prop.val>0.5, 1-prop.val, prop.val) 
p.ref1.between

prop.val <- nrow(refmodel2.summary.group[refmodel2.summary.group$R.cor.between<observed.summary$obs.cor.between, ])/nrow(refmodel2.summary.group) 
p.ref2.between<- ifelse(prop.val>0.5, 1-prop.val, prop.val) 
p.ref2.between

# eigenvector
prop.val <- nrow(refmodel1.summary.group[refmodel1.summary.group$R.cor.eigen<observed.summary$obs.cor.eigen, ])/nrow(refmodel1.summary.group) 
p.ref1.ec<- ifelse(prop.val>0.5, 1-prop.val, prop.val) 
p.ref1.ec

prop.val <- nrow(refmodel2.summary.group[refmodel2.summary.group$R.cor.eigen<observed.summary$obs.cor.eigen, ])/nrow(refmodel2.summary.group) 
p.ref2.ec<- ifelse(prop.val>0.5, 1-prop.val, prop.val) 
p.ref2.ec
```



Group-based metrics


## network-based measures
Note the different y-scales
```{r, network.beans, cache=FALSE, fig.height=4, fig.width=5.75}
par(mfrow=c(1,2))

# average path length
beanplot(refmodel1.summary.group$Rcrowd.apl, refmodel1.summary.group$Rdisp.apl, refmodel2.summary.group$Rdisp.apl,  
         main="Average path length", 
         ylab="", 
         ylim = c(1,3), log="",
         xlab = "", names = xlabels, 
         
         #add custom bean colorscrowds
         col = list(c(alpha(crowds, bean.alpha), beaninlines, beaninlines, "black"), #bean 1 
                    c(alpha(displace, bean.alpha), beaninlines, beaninlines, "black"), #bean 2
                    c(alpha(col.ltgn, bean.alpha), beaninlines, beaninlines, "black") #bean 3
                    ),          

         border = beanborder, las=1, ll = 0.1, beanlinewd = 2,
         what = c(FALSE, TRUE, TRUE, TRUE)) # remove overall line

  # add points for observed values

  points(1,observed.summary$Obcrowd.apl, col= crowds , pch=obsval.pch, cex=obsval.size, lwd=2) # crowds
  points(2,observed.summary$Obdisp.apl, col= displace, pch=obsval.pch, cex=obsval.size, lwd=2) # displacements
  points(3,observed.summary$Obcrowd.apl, col= crowds , pch=obsval.pch, cex=obsval.size, lwd=2) # crowds
  
  points(1,observed.summary$Obcrowd.apl, col= obs.vals , pch=obsval.hlt.pch.plus, cex=obsval.hlt.cex) # crowds
  points(2,observed.summary$Obdisp.apl, col= obs.vals, pch=obsval.hlt.pch, cex=obsval.hlt.cex) # displacements
  points(3,observed.summary$Obcrowd.apl, col= obs.vals , pch=obsval.hlt.pch.plus, cex=obsval.hlt.cex) # crowds
  
  text(1, 1.23, "NS")
  text(2, 1.25, "*")
  text(3, 1.25, "NS")
  
  abline(h=observed.summary$ObtotalCD.apl, col=alpha(obs.vals, pooled.alpha), lwd = linewidth) # add line estimate of totalDC 

  
  
# efficiency
beanplot(refmodel1.summary.group$Rcrowd.eff, refmodel1.summary.group$Rdisp.eff,refmodel2.summary.group$Rdisp.eff,
         main ="Efficiency", 
         ylab="", las=1, log="",
         ylim= c(0.2,0.7),
        xlab = "", names = xlabels, 
        
         #add custom bean colorscrowds
         col = list(c(alpha(crowds, bean.alpha), beaninlines, beaninlines, "black"), #bean 1 
                    c(alpha(displace, bean.alpha), beaninlines, beaninlines, "black"), #bean 2
                    c(alpha(col.ltgn, bean.alpha), beaninlines, beaninlines, "black") #bean 3
                    ),         
         border = beanborder, las=1, ll = 0.1, beanlinewd = 2,
         what = c(FALSE, TRUE, TRUE, TRUE)) # remove overall line

  # add points for observed values

  points(1,observed.summary$Obcrowd.eff, col= crowds , pch=obsval.pch, cex=obsval.size, lwd=2) # crowds
  points(2,observed.summary$Obdisp.eff, col= displace, pch=obsval.pch, cex=obsval.size, lwd=2) # displacements
  points(3,observed.summary$Obcrowd.eff, col= crowds , pch=obsval.pch, cex=obsval.size, lwd=2) # crowds
  
  points(1,observed.summary$Obcrowd.eff, col= obs.vals , pch=obsval.hlt.pch, cex=obsval.hlt.cex) # crowds
  points(2,observed.summary$Obdisp.eff, col= obs.vals, pch=obsval.hlt.pch, cex=obsval.hlt.cex) # displacements
  points(3,observed.summary$Obcrowd.eff, col= obs.vals , pch=obsval.hlt.pch.plus, cex=obsval.hlt.cex) # crowds
  
  text(1, 0.65, "*")
  text(2, 0.65, "*")
  text(3, 0.65, "NS")
  
  abline(h=observed.summary$ObtotalCD.eff, col=alpha(obs.vals, pooled.alpha), lwd = linewidth) # add line estimate of totalDC 
  
# save plot
dev.print(pdf, file="plot.network.beans.pdf")  
```
Are observed values significantly different from random values in reference models?

find proportion of random values less than the observed values, you can use this as a kind of p value. p should be >0.975 for two-tailed test, >0.95 for one-tailed test for something significantly different from the random values in the reference model
  
```{r}
# p-values network measures

# average path length
prop.val <- nrow(refmodel1.summary.group[refmodel1.summary.group$Rcrowd.apl<observed.summary$Obcrowd.apl, ])/nrow(refmodel1.summary.group) 
p.ref1.crowd.apl<- ifelse(prop.val>0.5, 1-prop.val, prop.val)
p.ref1.crowd.apl

prop.val <- nrow(refmodel1.summary.group[refmodel1.summary.group$Rdisp.apl<observed.summary$Obdisp.apl, ])/nrow(refmodel1.summary.group) 
p.ref1.disp.apl<- ifelse(prop.val>0.5, 1-prop.val, prop.val)
p.ref1.disp.apl

prop.val <- nrow(refmodel2.summary.group[refmodel2.summary.group$Rdisp.apl<observed.summary$Obcrowd.apl, ])/nrow(refmodel2.summary.group) 
p.ref2.apl<- ifelse(prop.val>0.5, 1-prop.val, prop.val)
p.ref2.apl

# effectiveness
prop.val <- nrow(refmodel1.summary.group[refmodel1.summary.group$Rcrowd.eff<observed.summary$Obcrowd.eff, ])/nrow(refmodel1.summary.group) 
p.ref1.crowd.eff<- ifelse(prop.val>0.5, 1-prop.val, prop.val) 
p.ref1.crowd.eff

prop.val <- nrow(refmodel1.summary.group[refmodel1.summary.group$Rdisp.eff<observed.summary$Obdisp.eff, ])/nrow(refmodel1.summary.group) 
p.ref1.disp.eff<- ifelse(prop.val>0.5, 1-prop.val, prop.val) 
p.ref1.disp.eff

prop.val <- nrow(refmodel2.summary.group[refmodel2.summary.group$Rdisp.eff<observed.summary$Obcrowd.eff, ])/nrow(refmodel2.summary.group) 
p.ref2.eff<- ifelse(prop.val>0.5, 1-prop.val, prop.val) 
p.ref2.eff

```



# Hierarchy structure plots combined
The distribution of randomized crowds and displacements (ref model 1) and sparse sampled displacements (ref model 2) with observed values

NB! changed * to a dot sign if result wasn't significant but I don't think it is well visible. 
```{r, hierarchy.beans, cache=FALSE, fig.height=4, fig.width=8.5}
par(mfrow=c(1,3))


# linearity
beanplot(refmodel1.summary.group$Rcrowd.linearity, refmodel1.summary.group$Rdisp.linearity, refmodel2.summary.group$Rdisp.linearity, 
         main="Linearity", 
         ylab="h'", log = "", ylim = ylim,
         xlab = "", names = xlabels, 
         
         #add custom bean colorscrowds
         col = list(c(alpha(crowds, bean.alpha), beaninlines, beaninlines, "black"), #bean 1 
                    c(alpha(displace, bean.alpha), beaninlines, beaninlines, "black"), #bean 2
                    c(alpha(col.ltgn, bean.alpha), beaninlines, beaninlines, "black") #bean 3
                    ), 
        
         border = beanborder, 
         las=1, 
         ll = 0.1, beanlinewd = 2,
         cutmin=0, cutmax=1,
         what = c(FALSE, TRUE, TRUE, TRUE)) # remove overall line

  # add points for observed values
  points(1,observed.summary$Obcrowd.linearity, col= crowds, pch=obsval.pch, cex=obsval.size, lwd=2) # crowds
  points(2,observed.summary$Obdisp.linearity, col= displace, pch=obsval.pch, cex=obsval.size, lwd=2) # displacements
  points(3,observed.summary$Obcrowd.linearity, col= crowds , pch=obsval.pch, cex=obsval.size, lwd=2) # crowds

  points(1,observed.summary$Obcrowd.linearity, col= obs.vals, pch=obsval.hlt.pch, cex=obsval.hlt.cex) # crowds
  points(2,observed.summary$Obdisp.linearity, col= obs.vals, pch=obsval.hlt.pch, cex=obsval.hlt.cex) # displacements
  points(3,observed.summary$Obcrowd.linearity, col= obs.vals , pch=obsval.hlt.pch.plus, cex=obsval.hlt.cex) # crowds

  abline(h=observed.summary$ObtotalCD.linearity, col=alpha(obs.vals, pooled.alpha), lwd = linewidth)  # add line estimate of totalDC 

 text(1, 0.6, "*")
  text(2, 0.6, "*")
  text(3, 0.6, "NS")

# steepness
beanplot(refmodel1.summary.group$Rcrowd.steepness, refmodel1.summary.group$Rdisp.steepness,refmodel2.summary.group$Rdisp.steepness,
         main="Steepness", 
         ylab="Dij", las=1, log = "",
         ylim = ylim,
         xlab = "", names = xlabels, 
        
         #add custom bean colorscrowds
         col = list(c(alpha(crowds, bean.alpha), beaninlines, beaninlines, "black"), #bean 1 
                    c(alpha(displace, bean.alpha), beaninlines, beaninlines, "black"), #bean 2
                    c(alpha(col.ltgn, bean.alpha), beaninlines, beaninlines, "black") #bean 3
                    ),         
         
         border = beanborder, las=1, ll = 0.1, beanlinewd = 2,
         cutmin=0, cutmax=1, #so distributions not plotted past 0-1 range
         what = c(FALSE, TRUE, TRUE, TRUE)) # remove overall line

  # add points for observed values

  points(1,observed.summary$Obcrowd.steepness, col=crowds, pch=obsval.pch, cex=obsval.size, lwd=2) # crowds
  points(2,observed.summary$Obdisp.steepness, col=displace, pch=obsval.pch, cex=obsval.size, lwd=2) # displacements
  points(3,observed.summary$Obcrowd.steepness, col= crowds , pch=obsval.pch, cex=obsval.size, lwd=2) # crowds
  
  points(1,observed.summary$Obcrowd.steepness, col=obs.vals, pch=obsval.hlt.pch, cex=obsval.hlt.cex) # crowds
  points(2,observed.summary$Obdisp.steepness, col=obs.vals, pch=obsval.hlt.pch, cex=obsval.hlt.cex) # displacements
  points(3,observed.summary$Obcrowd.steepness, col= obs.vals , pch=obsval.hlt.pch.plus, cex=obsval.hlt.cex) # crowds
  
  abline(h=observed.summary$ObtotalCD.steepness, col=alpha(obs.vals, pooled.alpha), lwd = linewidth)  # add line estimate of totalDC 

   text(1, 0.6, "*")
  text(2, 0.6, "*")
  text(3, 0.6, "NS")

# transitivity
beanplot(refmodel1.summary.group$Rcrowd.transi.ttri, refmodel1.summary.group$Rdisp.transi.ttri,
         refmodel2.summary.group$Rdisp.transi.ttri,
         main ="Transitivity", 
         ylab="Triangle motifs",
         ylim= ylim,
         xlab = "", names = xlabels, 
         
         #add custom bean colorscrowds
         col = list(c(alpha(crowds, bean.alpha), beaninlines, beaninlines, "black"), #bean 1 
                    c(alpha(displace, bean.alpha), beaninlines, beaninlines, "black"), #bean 2
                    c(alpha(col.ltgn, bean.alpha), beaninlines, beaninlines, "black") #bean 3
                    ), 
         
         border = beanborder, las=1, ll = 0.1, beanlinewd = 2,
         cutmin=0, cutmax=1,
         what = c(FALSE, TRUE, TRUE, TRUE)) # remove overall line

  # add points for observed values

  points(1,observed.summary$Obcrowd.transi.ttri, col= crowds , pch=obsval.pch, cex=obsval.size, lwd=2) # crowds
  points(2,observed.summary$Obdisp.transi.ttri, col= displace, pch=obsval.pch, cex=obsval.size, lwd=2) # displacements
  points(3,observed.summary$Obcrowd.transi.ttri, col= crowds , pch=obsval.pch, cex=obsval.size, lwd=2) # crowds
  
  points(1,observed.summary$Obcrowd.transi.ttri, col= obs.vals , pch=obsval.hlt.pch.plus, cex=obsval.hlt.cex) # crowds
  points(2,observed.summary$Obdisp.transi.ttri, col= obs.vals, pch=obsval.hlt.pch.plus, cex=obsval.hlt.cex) # displacements
  points(3,observed.summary$Obcrowd.transi.ttri, col= obs.vals , pch=obsval.hlt.pch.plus, cex=obsval.hlt.cex) # crowds
  
  abline(h=observed.summary$ObtotalCD.transi.ttri, col=alpha(obs.vals, pooled.alpha), lwd = linewidth) # add line estimate of totalDC 

   text(1, 0.3, "NS")
  text(2, 0.3, "NS")
  text(3, 0.3, "NS")
  
# save plot
dev.print(pdf, file="plot.hierarchy.beans.pdf")
  

```
Are observed values significantly different from random values in reference models?

find proportion of random values less than the observed values, you can use this as a kind of p value. p should be >0.975 for two-tailed test, >0.95 for one-tailed test for something significantly different from the random values in the reference model
  
```{r}
# p-values dominance measures

# linearity
prop.val <- nrow(refmodel1.summary.group[refmodel1.summary.group$Rcrowd.linearity<observed.summary$Obcrowd.linearity, ])/nrow(refmodel1.summary.group) 
p.ref1.crowd.lin<- ifelse(prop.val>0.5, 1-prop.val, prop.val)
p.ref1.crowd.lin

prop.val <- nrow(refmodel1.summary.group[refmodel1.summary.group$Rdisp.linearity<observed.summary$Obdisp.linearity, ])/nrow(refmodel1.summary.group) 
p.ref1.disp.lin<- ifelse(prop.val>0.5, 1-prop.val, prop.val)
p.ref1.disp.lin

prop.val <- nrow(refmodel2.summary.group[refmodel2.summary.group$Rdisp.linearity<observed.summary$Obcrowd.linearity, ])/nrow(refmodel2.summary.group) 
p.ref2.lin<- ifelse(prop.val>0.5, 1-prop.val, prop.val)
p.ref2.lin

# steepness
prop.val <- nrow(refmodel1.summary.group[refmodel1.summary.group$Rcrowd.steepness<observed.summary$Obcrowd.steepness, ])/nrow(refmodel1.summary.group) 
p.ref1.crowd.steep<- ifelse(prop.val>0.5, 1-prop.val, prop.val) 
p.ref1.crowd.steep

prop.val <- nrow(refmodel1.summary.group[refmodel1.summary.group$Rdisp.steepness<observed.summary$Obdisp.steepness, ])/nrow(refmodel1.summary.group) 
p.ref1.disp.steep<- ifelse(prop.val>0.5, 1-prop.val, prop.val) 
p.ref1.disp.steep

prop.val <- nrow(refmodel2.summary.group[refmodel2.summary.group$Rdisp.steepness<observed.summary$Obcrowd.steepness, ])/nrow(refmodel2.summary.group) 
p.ref2.steep<- ifelse(prop.val>0.5, 1-prop.val, prop.val) 
p.ref2.steep

# transitivity
prop.val <- nrow(refmodel1.summary.group[refmodel1.summary.group$Rcrowd.transi.ttri<observed.summary$Obcrowd.transi.ttri, ])/nrow(refmodel1.summary.group) 
p.ref1.crowd.trans<- ifelse(prop.val>0.5, 1-prop.val, prop.val)
p.ref1.crowd.trans

prop.val <- nrow(refmodel1.summary.group[refmodel1.summary.group$Rdisp.transi.ttri<observed.summary$Obdisp.transi.ttri, ])/nrow(refmodel1.summary.group) 
p.ref1.disp.trans <- ifelse(prop.val>0.5, 1-prop.val, prop.val) 
p.ref1.disp.trans 

prop.val <- nrow(refmodel2.summary.group[refmodel2.summary.group$Rdisp.transi.ttri<observed.summary$Obcrowd.transi.ttri, ])/nrow(refmodel1.summary.group) 
p.ref2.trans<- ifelse(prop.val>0.5, 1-prop.val, prop.val) 
p.ref2.trans
```
  




## Aggression strategies
summary of number of runs per strategy and plot those with observed strategie in caption

```{r, network.beans, cache=FALSE, fig.height=4, fig.width=5.75}
# observed strategies
observed.summary$strategy.Obcrowd # "pure bully"
observed.summary$strategy.Obdisp  # "pure bully"
observed.summary$Obstrategy.totalCD # "pure bully"


# strategies per random run
strategies.Rcrowd<-group_by(ref.model.strategies, strategy.Rcrowd) %>%
  tally() %>% 
  mutate(behavior="crowd") %>%
  rename(strategy=strategy.Rcrowd) %>%
  add_row(strategy="close.competitor",n= 0, behavior="crowd") 
# 99% of reference runs consistent with observed pattern
strategies.Rdisp<-group_by(ref.model.strategies, strategy.Rdisp) %>%
  summarise(n=n()) %>% 
  mutate(behavior="displace") %>%
  rename(strategy=strategy.Rdisp) %>%
  add_row(strategy="close.competitor",n= 0, behavior="displace")
# 100% of reference runs consistent with observed pattern
strategies.sparse<-group_by(ref.model.strategies, strategy.sparse) %>%
  summarise(n=n()) %>% 
  mutate(behavior="sparse displace") %>%
  rename(strategy=strategy.sparse) %>%
  add_row(strategy="close.competitor",n= 0, behavior="sparse displace")
# 43% of reference runs consistent with observed pattern
strategies<-rbind(strategies.Rcrowd, strategies.Rdisp, strategies.sparse)

strategies$strategy<-factor(strategies$strategy, 
                            levels =c("downward.heuristic","close.competitor","pure.bully", "pure.undefined") , 
                            labels = c("Downward heuristic", "Close competitors", "Bullying", "Undefined") )

strategies$behavior<-factor(strategies$behavior, 
                            levels = c("crowd", "displace", "sparse displace"),
                            labels = c("ref1 crowds", "ref1 displace", "ref2 displace"))

ggplot(strategies, aes(x=behavior, y=n, fill=strategy)) +
  geom_col(aes(group= strategy), colour= beanborder) +
  theme_classic() +
  labs(y="percentage", x="", caption = "observed crowd = bullying \nobserved displace = bullying \nobserved pooled = bullying") +
  theme(plot.caption=element_text(hjust = 0) ) +
  scale_fill_manual(values=c(alpha("lightgrey", 0.4),alpha("red", 0.4), alpha("blue", 0.4), alpha("black", 0.6)))  


# save plot
dev.print(pdf, file="plot.strategies.pdf")
```

proportion (percentage) of reference model runs that are consistent with observed pattern. 
```{r}
# ref model 1 crowds
sum.ref1.crowds<- 


```



## supplemental info
```{r, network.beans, cache=FALSE, fig.height=4, fig.width=5.75}
par(mfrow=c(1,2))

# density
beanplot(refmodel1.summary.group$Rcrowd.density, refmodel1.summary.group$Rdisplace.density, refmodel2.summary.group$Rdisplace.density,  
         main="Density", 
         ylab="Proportion agonistic relationships", 
         ylim = ylim,
         xlab = "", names = xlabels, 
         
         #add custom bean colorscrowds
         col = list(c(alpha(crowds, bean.alpha), beaninlines, beaninlines, "black"), #bean 1 
                    c(alpha(displace, bean.alpha), beaninlines, beaninlines, "black"), #bean 2
                    c(alpha(col.ltgn, bean.alpha), beaninlines, beaninlines, "black") #bean 3
                    ),          

         border = beanborder, las=1, ll = 0.1, beanlinewd = 2,
         what = c(FALSE, TRUE, TRUE, TRUE)) # remove overall line

  # add points for observed values

  points(1,observed.summary$Obcrowd.density, col= crowds , pch=obsval.pch, cex=obsval.size, lwd=2) # crowds
  points(2,observed.summary$Obdisplace.density, col= displace, pch=obsval.pch, cex=obsval.size, lwd=2) # displacements
  points(3,observed.summary$Obcrowd.density, col= crowds , pch=obsval.pch, cex=obsval.size, lwd=2) # crowds
  
  points(1,observed.summary$Obcrowd.density, col= obs.vals , pch=obsval.hlt.pch, cex=obsval.hlt.cex) # crowds
  points(2,observed.summary$Obdisplace.density, col= obs.vals, pch=obsval.hlt.pch, cex=obsval.hlt.cex) # displacements
  points(3,observed.summary$Obcrowd.density, col= obs.vals , pch=obsval.hlt.pch.plus, cex=obsval.hlt.cex) # crowds
  
  abline(h=observed.summary$ObtotalCD.density, col=alpha(obs.vals, pooled.alpha), lwd = linewidth) # add line estimate of totalDC 

  
# sparseness
beanplot(refmodel1.summary.group$Rcrowd.prunk.pu, refmodel1.summary.group$Rdisp.prunk.pu,refmodel2.summary.group$Rdisp.prunk.pu,
         main ="Sparseness", 
         ylab="Proportion non-interacting dyads", las=1, 
         ylim= ylim,
        xlab = "", names = xlabels, 
        
         #add custom bean colorscrowds
         col = list(c(alpha(crowds, bean.alpha), beaninlines, beaninlines, "black"), #bean 1 
                    c(alpha(displace, bean.alpha), beaninlines, beaninlines, "black"), #bean 2
                    c(alpha(col.ltgn, bean.alpha), beaninlines, beaninlines, "black") #bean 3
                    ),         
         border = beanborder, las=1, ll = 0.1, beanlinewd = 2,
         what = c(FALSE, TRUE, TRUE, TRUE)) # remove overall line

  # add points for observed values

  points(1,observed.summary$Obcrowd.prunk.pu, col= crowds , pch=obsval.pch, cex=obsval.size, lwd=2) # crowds
  points(2,observed.summary$Obdisp.prunk.pu, col= displace, pch=obsval.pch, cex=obsval.size, lwd=2) # displacements
  points(3,observed.summary$Obcrowd.prunk.pu, col= crowds , pch=obsval.pch, cex=obsval.size, lwd=2) # crowds
  
  points(1,observed.summary$Obcrowd.prunk.pu, col= obs.vals , pch=obsval.hlt.pch, cex=obsval.hlt.cex) # crowds
  points(2,observed.summary$Obdisp.prunk.pu, col= obs.vals, pch=obsval.hlt.pch, cex=obsval.hlt.cex) # displacements
  points(3,observed.summary$Obcrowd.prunk.pu, col= obs.vals , pch=obsval.hlt.pch.plus, cex=obsval.hlt.cex) # crowds
  
  abline(h=observed.summary$ObtotalCD.prunk.pu, col=alpha(obs.vals, pooled.alpha), lwd = linewidth) # add line estimate of totalDC 
  

# save plot
dev.print(pdf, file="plot.network.SM.pdf")
```
Are observed values significantly different from random values in reference models?

find proportion of random values less than the observed values, you can use this as a kind of p value. p should be >0.975 for two-tailed test, >0.95 for one-tailed test for something significantly different from the random values in the reference model
  
```{r}
# p-values network

# density
prop.val <- nrow(refmodel1.summary.group[refmodel1.summary.group$Rcrowd.density<observed.summary$Obcrowd.density, ])/nrow(refmodel1.summary.group) 
p.ref1.crowd.den<- ifelse(prop.val>0.5, 1-prop.val, prop.val)
p.ref1.crowd.den

prop.val <- nrow(refmodel1.summary.group[refmodel1.summary.group$Rdisplace.density<observed.summary$Obdisplace.density, ])/nrow(refmodel1.summary.group) 
p.ref1.disp.den<- ifelse(prop.val>0.5, 1-prop.val, prop.val)
p.ref1.disp.den

prop.val <- nrow(refmodel2.summary.group[refmodel2.summary.group$Rdisplace.density<observed.summary$Obcrowd.density, ])/nrow(refmodel2.summary.group) 
p.ref2.den<- ifelse(prop.val>0.5, 1-prop.val, prop.val)
p.ref2.den

# sparseness
prop.val <- nrow(refmodel1.summary.group[refmodel1.summary.group$Rcrowd.prunk.pu<observed.summary$Obcrowd.prunk.pu, ])/nrow(refmodel1.summary.group) 
p.ref1.crowd.sparse<- ifelse(prop.val>0.5, 1-prop.val, prop.val) 
p.ref1.crowd.sparse

prop.val <- nrow(refmodel1.summary.group[refmodel1.summary.group$Rdisp.prunk.pu<observed.summary$Obdisp.prunk.pu, ])/nrow(refmodel1.summary.group) 
p.ref1.disp.sparse<- ifelse(prop.val>0.5, 1-prop.val, prop.val) 
p.ref1.disp.sparse

prop.val <- nrow(refmodel2.summary.group[refmodel2.summary.group$Rdisp.prunk.pu<observed.summary$Obcrowd.prunk.pu, ])/nrow(refmodel2.summary.group) 
p.ref2.sparse<- ifelse(prop.val>0.5, 1-prop.val, prop.val) 
p.ref2.sparse
```

# sessioninfo
```{r}
sessionInfo()
```
