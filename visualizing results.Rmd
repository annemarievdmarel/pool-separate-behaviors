---
title: "Visualizing results"
author: "Annemarie"
date: "01/06/2020"
output: html_document
---

Comparison of real vs randomized data in 4-6 plots:
- correlation crowds vs displacements

Hierarchy structure
- linearity
- steepness
- transitivity
Network-based measures
- density
- sparseness
Aggression pattern
- strategies

# load packages
```{r setup, include=FALSE}
library(beanplot)
library(scales)
library(ggplot2)

```

# Import data
```{r}
# summaries
observed.summary <- read.csv("EXPLORE-SUMM.observed.csv")
head(observed.summary)
refmodel1.summary<- read.csv("EXPLORE-SUMM.refmodel.csv") # reference model 1
head(refmodel1.summary)
refmodel2.summary<-read.csv("EXPLORE-SUMM.sparse.refmodel.csv") # reference model 2
head(refmodel2.summary)

# reference model strategies
refmodel1.strategies <- read.csv("EXPLORE_SUMM.refmodel.strategies.csv") # observed
str(refmodel1.strategies)
refmodel2.strategies<- read.csv("EXPLORE_SUMM.sparse.refmodel.strategies.csv") %>%
  rename(focus.sparse = focus.Rdisp, 
         position.sparse = position.Rdisp, 
         strategy.sparse = strategy.Rdisp) %>% 
  select(-X)
str(refmodel2.strategies)

ref.model.strategies<-left_join(refmodel1.strategies, refmodel2.strategies, by="run.code")
head(ref.model.strategies)

```

#### Distribution plots

# correlation
```{r pressure, echo=FALSE}
# correlation
beanplot(refmodel1.summary$run.cor, refmodel2.summary$run.cor, 
         main="Distribution of correlations", 
         ylab="Correlation strength", 
         xlab = "reference model", 
         ylim=c(0, 1),
         las=1, col = c("lightgrey", alpha("black", 0.6)), border = "NA") 
abline(h=observed.summary$obs.cor, col="red")  # add line estimate of totalDC 
```

# Hierarchy structure plots combined
The distribution of randomized crowds and displacements (ref model 1) and sparse sampled displacements (ref model 2) with observed values
```{r}
par(mfrow=c(3,1))


# linearity
beanplot(refmodel1.summary$Rcrowd.linearity, refmodel1.summary$Rdisp.linearity, refmodel2.summary$Rdisp.linearity, 
         main="Linearity", 
         ylab="h index", log = "",
         ylim = c(min(observed.summary$Obcrowd.linearity-0.1), 
                  max(observed.summary$Obdisp.linearity+0.1)),
         xlab = "", names = c("ref1 crowds", "ref1 displace", "ref2 displace"),
         col = list(alpha("#8da0cb", 0.6),c(alpha("#fc8d62", 0.6)), alpha("black", 0.6)), 
         border = 'NA', 
         ll = 0.1, beanlinewd = 0.1)
points(1,observed.summary$Obcrowd.linearity, col= "#8da0cb", pch=19) # crowds
points(2,observed.summary$Obdisp.linearity, col= "#fc8d62", pch=19) # displacements
points(3,observed.summary$Obcrowd.linearity, col= "#8da0cb" , pch=19) # crowds
abline(h=observed.summary$ObtotalCD.linearity, col="red")  # add line estimate of totalDC 


# steepness
beanplot(refmodel1.summary$Rcrowd.steepness, refmodel1.summary$Rdisp.steepness,refmodel2.summary$Rdisp.steepness,
         main="Steepness", 
         ylab="Dij", las=1, log = "",
         ylim = c(min(observed.summary$Obcrowd.steepness-0.1), 
        max(refmodel.summary$Rdisp.steepness,observed.summary$Obdisp.steepness+0.1)),
         xlab = "", names = c("ref1 crowds", "ref1 displace", "ref2 displace"),
         col = list(alpha("#8da0cb", 0.6),c(alpha("#fc8d62", 0.6)), alpha("black", 0.6)), 
         border = 'NA', 
         ll = 0.1, beanlinewd = 0.1)
points(1,observed.summary$Obcrowd.steepness, col="#8da0cb", pch=19) # crowds
points(2,observed.summary$Obdisp.steepness, col="#fc8d62", pch=19) # displacements
points(3,observed.summary$Obcrowd.steepness, col= "#8da0cb" , pch=19) # crowds
abline(h=observed.summary$ObtotalCD.steepness, col="red")  # add line estimate of totalDC 


# transitivity
beanplot(refmodel1.summary$Rcrowd.transi.ttri, refmodel1.summary$Rdisp.transi.ttri,
         refmodel2.summary$Rdisp.transi.ttri,
         main ="Transitivity", 
         ylab="Triangle motifs",
         ylim=c(min(refmodel.summary$Rdisp.transi.ttri-0.1), 
                max(refmodel.summary$Rdisp.transi.ttri,refmodel.summary$Rdisp.transi.ttri+0.1)),
         xlab = "", names = c("ref1 crowds", "ref1 displace", "ref2 displace"),
         col = list(alpha("#8da0cb", 0.6),c(alpha("#fc8d62", 0.6)), alpha("black", 0.6)), 
         border = 'NA', 
         ll = 0.1, 
         beanlinewd = 0.1)
points(1,observed.summary$Obcrowd.transi.ttri, col= "#8da0cb" , pch=19) # crowds
points(2,observed.summary$Obdisp.transi.ttri, col= "#fc8d62", pch=19) # displacements
points(3,observed.summary$Obcrowd.transi.ttri, col= "#8da0cb" , pch=19) # crowds
abline(h=observed.summary$ObtotalCD.transi.ttri, col="red") # add line estimate of totalDC 

# add legend 
# outside plot?  ... how to do this easily in base R?
# legend("topleft", bty = "n",  legend=c("crowds", "displace"),
#       col=c("#8da0cb", "#fc8d62"), pch = 19,
#       title="observed") 

```

## Network-based measures combined

```{r}
par(mfrow=c(2,1))

# density
beanplot(refmodel1.summary$Rcrowd.density, refmodel1.summary$Rdisplace.density, refmodel2.summary$Rdisplace.density,  
         main="Density", 
         ylab="prop agonistic dyads", 
         ylim = c(min(observed.summary$Obcrowd.density-0.1), 
                  max(observed.summary$Obdisplace.density+0.1)),
         xlab = "", names = c("ref1 crowds", "ref1 displace", "ref2 displace"),
         col = list(alpha("#8da0cb", 0.6),c(alpha("#fc8d62", 0.6)), alpha("black", 0.6)), 
         border = 'NA', 
         ll = 0.05, beanlinewd = 0.1)
points(1,observed.summary$Obcrowd.density, col="#8da0cb" , pch=19) # crowds
points(2,observed.summary$Obdisplace.density, col="#fc8d62", pch=19) # displacements
points(3,observed.summary$Obcrowd.density, col="#8da0cb" , pch=19) # crowds
abline(h=observed.summary$ObtotalCD.density, col="red") # add line estimate of totalDC


# sparseness
beanplot(refmodel1.summary$Rcrowd.prunk.pu, refmodel1.summary$Rdisp.prunk.pu,refmodel2.summary$Rdisp.prunk.pu,
         main ="Sparseness", 
         ylab="prop null dyads", 
         ylim=c(min(observed.summary$Obdisp.prunk.pu-0.1), 
                max(refmodel.summary$Rcrowd.prunk.pu,observed.summary$Obcrowd.prunk.pu+0.1)),
         las=1, xlab = "", names = c("ref1 crowds", "ref1 displace", "ref2 displace"),
         col = list(alpha("#8da0cb", 0.6),c(alpha("#fc8d62", 0.6)), alpha("black", 0.6)), 
         border = 'NA', 
         ll = 0.05, beanlinewd = 0.1)
points(1,observed.summary$Obcrowd.prunk.pu, col="#8da0cb" , pch=19) # crowds
points(2,observed.summary$Obdisp.prunk.pu, col="#fc8d62", pch=19) # displacements
points(3,observed.summary$Obcrowd.prunk.pu, col="#8da0cb" , pch=19) # crowds
abline(h=observed.summary$ObtotalCD.prunk.pu, col="red")  # add line estimate of totalDC 

```



## Aggression strategies
summary of number of runs per strategy and plot those with observed strategie in caption

```{r}
# observed strategies
observed.summary$strategy.Obcrowd # "downward.heuristic"
observed.summary$strategy.Obdisp  # "pure bully"
observed.summary$Obstrategy.totalCD # "downward.heuristic"


# strategies per random run
strategies.Rcrowd<-group_by(ref.model.strategies, strategy.Rcrowd) %>%
  tally() %>% 
  mutate(behavior="crowd") %>%
  rename(strategy=strategy.Rcrowd) %>%
  add_row(strategy="close.competitor",n= 0, behavior="crowd")
strategies.Rdisp<-group_by(ref.model.strategies, strategy.Rdisp) %>%
  summarise(n=n()) %>% 
  mutate(behavior="displace") %>%
  rename(strategy=strategy.Rdisp) %>%
  add_row(strategy="close.competitor",n= 0, behavior="displace")
strategies.sparse<-group_by(ref.model.strategies, strategy.sparse) %>%
  summarise(n=n()) %>% 
  mutate(behavior="sparse displace") %>%
  rename(strategy=strategy.sparse) %>%
  add_row(strategy="close.competitor",n= 0, behavior="sparse displace")
strategies<-rbind(strategies.Rcrowd, strategies.Rdisp, strategies.sparse)

strategies$strategy<-factor(strategies$strategy, 
                            levels =c("downward.heuristic","close.competitor","pure.bully", "pure.undefined") , 
                            labels = c("Downward heuristic", "Close competitors", "Bullying", "Undefined") )

strategies$behavior<-factor(strategies$behavior, 
                            levels = c("crowd", "displace", "sparse displace"),
                            labels = c("ref1 crowds", "ref1 displace", "ref2 displace"))

ggplot(strategies, aes(x=behavior, y=n, fill=strategy)) +
  geom_col(aes(group= strategy)) +
  theme_classic() +
  labs(y="percentage", x="", caption = "observed crowd = downward heuristic \nobserved displace = bullying \nobserved pooled = downward heuristic") +
  theme(plot.caption=element_text(hjust = 0) ) +
  scale_fill_manual(values=c(alpha("lightgrey", 0.4),alpha("red", 0.4), alpha("blue", 0.4), alpha("black", 0.6)))  

```



# sessioninfo
```{r}
sessionInfo()
```
