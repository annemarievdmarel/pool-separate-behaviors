---
title: "Visualizing results"
author: "Annemarie"
date: "01/06/2020"
output: html_document
---

Comparison of real vs randomized data in 4-6 plots:
- correlation crowds vs displacements
- density
- linearity
- steepness
- transitivity
- sparseness

# load packages
```{r setup, include=FALSE}
library(beanplot)
library(scales)
library(ggplot2)
detach(package:plyr)
```

# Import data
OBSERVED
```{r}
refmodel.summary<- read.csv("EXPLORE-SUMM.refmodel.csv")
head(refmodel.summary)
observed.summary <- read.csv("EXPLORE-SUMM.observed.csv")
head(observed.summary)
```

SAMPLED
```{r}
refmodel.summary<- read.csv("EXPLORE-SUMM.sampled.refmodel.csv")
head(refmodel.summary)
observed.summary <- read.csv("EXPLORE-SUMM.sampled.csv")
head(observed.summary)

```


## Including Plots
# correlation
```{r pressure, echo=FALSE}
# correlation
beanplot(refmodel.summary$run.cor,  
         main="Distribution of correlations", 
         ylab="Correlation strength", 
         ylim=c(0, 1),
         las=1, col = c("lightgrey", alpha("black", 0.6)), border = "NA") 
points(1,observed.summary$obs.cor, col="red", pch=7)

```


# Proportion of number of interactions by total observed
```{r, echo=FALSE}
# histogram dyadic relationships
beanplot(refmodel.summary$prop.Rcrowd, refmodel.summary$prop.Rdisplace,  
         main="Distribution of proportions", 
         ylab="# interactions/total observed", 
         ylim = c(min(observed.summary$prop.Obcrowd-0.1), 
                  max(observed.summary$prop.Obdisplace+0.1)),
         xlab = "interaction", names = c("crowds", "displacements"),
         col = list(alpha("#8da0cb", 0.6),c(alpha("#fc8d62", 0.6)), alpha("black", 0.6)), 
                    border = 'NA', 
         ll = 0.1, beanlinewd = 0.1)
points(1,observed.summary$prop.Obcrowd, col="#8da0cb" , pch=7) # crowds
points(2,observed.summary$prop.Obdisplace, col="#fc8d62", pch=7) # displacements
```

# Density
```{r, echo=FALSE}
# density
beanplot(refmodel.summary$Rcrowd.density, refmodel.summary$Rdisplace.density,  
         main="Distribution of density", 
         ylab="prop agonistic dyads/total dyads", 
         ylim = c(min(observed.summary$Obcrowd.density-0.1), 
                  max(observed.summary$Obdisplace.density+0.1)),
         xlab = "interaction", names = c("crowds", "displacements"),
         col = list(alpha("#8da0cb", 0.6),c(alpha("#fc8d62", 0.6)), alpha("black", 0.6)), 
         border = 'NA', 
         ll = 0.05, beanlinewd = 0.1)
points(1,observed.summary$Obcrowd.density, col="#8da0cb" , pch=7) # crowds
points(2,observed.summary$Obdisplace.density, col="#fc8d62", pch=7) # displacements
abline(h=observed.summary$ObtotalCD.density, col="red")  # add line estimate of totalDC 
```
# Linearity
```{r, echo=FALSE}
# linearity
beanplot(refmodel.summary$Rcrowd.linearity, refmodel.summary$Rdisp.linearity, 
         main="Distribution of linearity", 
         ylab="h index", log = "",
         ylim = c(min(observed.summary$Obcrowd.linearity-0.1), 
                  max(observed.summary$Obdisp.linearity+0.1)),
         xlab = "interaction", names = c("crowds", "displacements"),
         col = list(alpha("#8da0cb", 0.6),c(alpha("#fc8d62", 0.6)), alpha("black", 0.6)), 
         border = 'NA', 
         ll = 0.1, beanlinewd = 0.1)
points(1,observed.summary$Obcrowd.linearity, col= "#8da0cb", pch=7) # crowds
points(2,observed.summary$Obdisp.linearity, col= "#fc8d62", pch=7) # displacements
abline(h=observed.summary$ObtotalCD.linearity, col="red")  # add line estimate of totalDC 
```

# Steepness
```{r, echo=FALSE}
# steepness
beanplot(refmodel.summary$Rcrowd.steepness, refmodel.summary$Rdisp.steepness,
         main="Distribution of steepness", 
         ylab="Dij", las=1, log = "",
         ylim = c(min(observed.summary$Obcrowd.steepness-0.1), 
        max(refmodel.summary$Rdisp.steepness,observed.summary$Obdisp.steepness+0.1)),
         xlab = "interaction", names = c("crowds", "displacements"),
         col = list(alpha("#8da0cb", 0.6),c(alpha("#fc8d62", 0.6)), alpha("black", 0.6)), 
         border = 'NA', 
         ll = 0.1, beanlinewd = 0.1)
points(1,observed.summary$Obcrowd.steepness, col="#8da0cb", pch=7) # crowds
points(2,observed.summary$Obdisp.steepness, col="#fc8d62", pch=7) # displacements
abline(h=observed.summary$ObtotalCD.steepness, col="red")  # add line estimate of totalDC 
```

# Sparseness
```{r}
# sparseness
beanplot(refmodel.summary$Rcrowd.prunk.pu, refmodel.summary$Rdisp.prunk.pu,
         main ="Distribution of sparseness", 
         ylab="Sparseness", 
         ylim=c(min(observed.summary$Obdisp.prunk.pu-0.1), 
                max(refmodel.summary$Rcrowd.prunk.pu,observed.summary$Obcrowd.prunk.pu+0.1)),
         las=1, xlab = "interaction", names = c("crowds", "displacements"),
         col = list(alpha("#8da0cb", 0.6),c(alpha("#fc8d62", 0.6)), alpha("black", 0.6)), 
         border = 'NA', 
         ll = 0.05, beanlinewd = 0.1)
points(1,observed.summary$Obcrowd.prunk.pu, col="#8da0cb" , pch=7) # crowds
points(2,observed.summary$Obdisp.prunk.pu, col="#fc8d62", pch=7) # displacements
abline(h=observed.summary$ObtotalCD.prunk.pu, col="red")  # add line estimate of totalDC 
```



# Transitivity
```{r}
# transitivity
beanplot(refmodel.summary$Rcrowd.transi.ttri, refmodel.summary$Rdisp.transi.ttri,
         main ="Distribution of transitivity", 
         ylab="Transitivity",
         ylim=c(min(refmodel.summary$Rdisp.transi.ttri-0.1), 
                max(refmodel.summary$Rdisp.transi.ttri,refmodel.summary$Rdisp.transi.ttri+0.1)),
         las=1, xlab = "interaction", names = c("crowds", "displacements"),
         col = list(alpha("#8da0cb", 0.6),c(alpha("#fc8d62", 0.6)), alpha("black", 0.6)), 
         border = 'NA', 
         ll = 0.1, beanlinewd = 0.1)
points(1,observed.summary$Obcrowd.transi.ttri, col= "#8da0cb" , pch=7) # crowds
points(2,observed.summary$Obdisp.transi.ttri, col= "#fc8d62", pch=7) # displacements
abline(h=observed.summary$ObtotalCD.transi.ttri, col="red")  # add line estimate of totalDC 

```

# Combine plots
using par(mfrow=c(3,2)) for the plots with crowds and displacements (6 total), then correlation plot separate
```{r}
par(mfrow=c(3,2))

# density
beanplot(refmodel.summary$Rcrowd.density, refmodel.summary$Rdisplace.density,  
         main="Density", 
         ylab="prop agonistic dyads/total dyads", 
         ylim = c(min(observed.summary$Obcrowd.density-0.1), 
                  max(observed.summary$Obdisplace.density+0.1)),
         #xlab = "", names = c("crowds", "displacements"),
         col = list(alpha("#8da0cb", 0.6),c(alpha("#fc8d62", 0.6)), alpha("black", 0.6)), 
         border = 'NA', 
         ll = 0.05, beanlinewd = 0.1)
points(1,observed.summary$Obcrowd.density, col="#8da0cb" , pch=7) # crowds
points(2,observed.summary$Obdisplace.density, col="#fc8d62", pch=7) # displacements
abline(h=observed.summary$ObtotalCD.density, col="red") # add line estimate of totalDC


# linearity
beanplot(refmodel.summary$Rcrowd.linearity, refmodel.summary$Rdisp.linearity, 
         main="Linearity", 
         ylab="h index", log = "",
         ylim = c(min(observed.summary$Obcrowd.linearity-0.1), 
                  max(observed.summary$Obdisp.linearity+0.1)),
         xlab = "", names = c("crowds", "displacements"),
         col = list(alpha("#8da0cb", 0.6),c(alpha("#fc8d62", 0.6)), alpha("black", 0.6)), 
         border = 'NA', 
         ll = 0.1, beanlinewd = 0.1)
points(1,observed.summary$Obcrowd.linearity, col= "#8da0cb", pch=7) # crowds
points(2,observed.summary$Obdisp.linearity, col= "#fc8d62", pch=7) # displacements
abline(h=observed.summary$ObtotalCD.linearity, col="red")  # add line estimate of totalDC 


# steepness
beanplot(refmodel.summary$Rcrowd.steepness, refmodel.summary$Rdisp.steepness,
         main="Steepness", 
         ylab="Dij", las=1, log = "",
         ylim = c(min(observed.summary$Obcrowd.steepness-0.1), 
        max(refmodel.summary$Rdisp.steepness,observed.summary$Obdisp.steepness+0.1)),
         xlab = "", names = c("crowds", "displacements"),
         col = list(alpha("#8da0cb", 0.6),c(alpha("#fc8d62", 0.6)), alpha("black", 0.6)), 
         border = 'NA', 
         ll = 0.1, beanlinewd = 0.1)
points(1,observed.summary$Obcrowd.steepness, col="#8da0cb", pch=7) # crowds
points(2,observed.summary$Obdisp.steepness, col="#fc8d62", pch=7) # displacements
abline(h=observed.summary$ObtotalCD.steepness, col="red")  # add line estimate of totalDC 


# sparseness
beanplot(refmodel.summary$Rcrowd.prunk.pu, refmodel.summary$Rdisp.prunk.pu,
         main ="Sparseness", 
         ylab="Sparseness", 
         ylim=c(min(observed.summary$Obdisp.prunk.pu-0.1), 
                max(refmodel.summary$Rcrowd.prunk.pu,observed.summary$Obcrowd.prunk.pu+0.1)),
         las=1, xlab = "", names = c("crowds", "displacements"),
         col = list(alpha("#8da0cb", 0.6),c(alpha("#fc8d62", 0.6)), alpha("black", 0.6)), 
         border = 'NA', 
         ll = 0.05, beanlinewd = 0.1)
points(1,observed.summary$Obcrowd.prunk.pu, col="#8da0cb" , pch=7) # crowds
points(2,observed.summary$Obdisp.prunk.pu, col="#fc8d62", pch=7) # displacements
abline(h=observed.summary$ObtotalCD.prunk.pu, col="red")  # add line estimate of totalDC 



# transitivity
beanplot(refmodel.summary$Rcrowd.transi.ttri, refmodel.summary$Rdisp.transi.ttri,
         main ="Transitivity", 
         ylab="Transitivity",
         ylim=c(min(refmodel.summary$Rdisp.transi.ttri-0.1), 
                max(refmodel.summary$Rdisp.transi.ttri,refmodel.summary$Rdisp.transi.ttri+0.1)),
         las=1, xlab = "", names = c("crowds", "displacements"),
         col = list(alpha("#8da0cb", 0.6),c(alpha("#fc8d62", 0.6)), alpha("black", 0.6)), 
         border = 'NA', 
         ll = 0.1, beanlinewd = 0.1)
points(1,observed.summary$Obcrowd.transi.ttri, col= "#8da0cb" , pch=7) # crowds
points(2,observed.summary$Obdisp.transi.ttri, col= "#fc8d62", pch=7) # displacements
abline(h=observed.summary$ObtotalCD.transi.ttri, col="red") # add line estimate of totalDC 

```

# aggression strategies
summary of number of runs per strategy and plot those vs observed value.

OBSERVED 
```{r}
# aggression strategies

ref.model.strategies <- read.csv("EXPLORE_SUMM.refmodel.strategies.csv") # observed
str(ref.model.strategies)

# strategies per random run
strategies.Rcrowd<-group_by(ref.model.strategies, strategy.Rcrowd) %>%
  tally() %>% 
  mutate(behavior="crowd") %>%
  rename(strategy=strategy.Rcrowd) %>%
  add_row(strategy="close.competitor",n= 0, behavior="crowd")
strategies.Rdisp<-group_by(ref.model.strategies, strategy.Rdisp) %>%
  summarise(n=n()) %>% 
  mutate(behavior="displace") %>%
  rename(strategy=strategy.Rdisp) %>%
  add_row(strategy="close.competitor",n= 0, behavior="displace")
strategies<-rbind(strategies.Rcrowd, strategies.Rdisp)

# observed strategies
observed.summary$strategy.Obcrowd # "downward.heuristic"
observed.summary$strategy.Obdisp  # "pure bully"
observed.summary$Obstrategy.totalCD # "downward.heuristic"

strategies$strategy<-factor(strategies$strategy, levels =c("downward.heuristic","close.competitor","pure.bully", "pure.undefined") , labels = c("Downward heuristic", "Close competitors", "Bullying", "Undefined") )

ggplot(strategies, aes(x=strategy, y=n, fill=behavior)) +
  geom_col(aes(group= behavior),  position=position_dodge()) +
  theme_classic() +
  scale_fill_manual(values=c(alpha("#8da0cb", 0.6),alpha("#fc8d62", 0.6)))  +    
  annotate("point", 3.25,30, col="red", pch=5) +
  annotate("point",0.75,30, col="blue", pch=4) +
  annotate("point",1,30, col="black", pch=7)

ggplot(strategies, aes(x=behavior, y=n, fill=strategy)) +
  geom_col(aes(group= strategy)) +
  theme_classic() +
  labs(y="percentage") +
  scale_fill_manual(values=c(alpha("lightgrey", 0.4),alpha("red", 0.4), alpha("blue", 0.4), alpha("black", 0.6)))  +    
  annotate("point", 2,25, col="white", pch=23, cex=4, bg="#fc8d62") + # displace  
  annotate("point",1,75, col="white", pch=23, bg="#8da0cb", cex=4) + # crowd
  annotate("point",1.5,55, col="white", pch=23,bg="black", cex=4)     # total DC
```
the totalCD point can be improved. I placed it between the 2 behaviors

SAMPLED
```{r}
# aggression strategies
ref.model.strategies <- read.csv("EXPLORE_SUMM.sample.refmodel.strategies.csv") # sampled
str(ref.model.strategies)

# strategies per random run
strategies.Rcrowd<-group_by(ref.model.strategies, strategy.Rcrowd) %>%
  summarise(n=n()) %>% 
  mutate(behavior="crowd") %>%
  rename(strategy=strategy.Rcrowd) %>%
  add_row(strategy="close.competitor",n= 0, behavior="crowd")
strategies.Rdisp<-group_by(ref.model.strategies, strategy.Rdisp) %>%
  summarise(n=n()) %>% 
  mutate(behavior="displace") %>%
  rename(strategy=strategy.Rdisp) %>%
  add_row(strategy="close.competitor",n= 0, behavior="displace")
strategies<-rbind(strategies.Rcrowd, strategies.Rdisp)

# observed strategies
observed.summary$strategy.Obcrowd # "downward.heuristic"
observed.summary$strategy.Obdisp  # "downward.heuristic"
observed.summary$Obstrategy.totalCD # "downward.heuristic"

strategies$strategy<-factor(strategies$strategy, levels =c("downward.heuristic","close.competitor","pure.bully", "pure.undefined") , labels = c("Downward heuristic", "Close competitors", "Bullying", "Undefined") )

ggplot(strategies, aes(x=strategy, y=n, fill=behavior)) +
  geom_col(aes(group= behavior),  position=position_dodge()) +
  theme_classic() +
  scale_fill_manual(values=c(alpha("#8da0cb", 0.6),alpha("#fc8d62", 0.6)))  +    
  annotate("point", 3.25,30, col="red", pch=5) +
  annotate("point",0.75,30, col="blue", pch=4) +
  annotate("point",1,30, col="black", pch=7)

ggplot(strategies, aes(x=behavior, y=n, fill=strategy)) +
  geom_col(aes(group= strategy)) +
  theme_classic() +
  labs(y="percentage") +
  scale_fill_manual(values=c(alpha("lightgrey", 0.4),alpha("red", 0.4), alpha("blue", 0.4), alpha("black", 0.6)))  +    
  annotate("point", 1,25, col="white", pch=23, cex=4, bg="#fc8d62") + # displace  
  annotate("point",1,75, col="white", pch=23, bg="#8da0cb", cex=4) + # crowd
  annotate("point",1,50, col="white", pch=23,bg="black", cex=4)     # total DC
```



# sessioninfo
```{r}
sessionInfo()
```
