---
title: "Visualizing results"
author: "Annemarie"
date: "01/06/2020"
output: html_document
---

Comparison of real vs randomized data in 4-6 plots:
- correlation crowds vs displacements

Hierarchy structure
- linearity
- steepness
- transitivity
Network-based measures
- density
- sparseness
Aggression pattern
- strategies

# load packages
```{r setup, include=FALSE}
library(beanplot)
library(scales)
library(ggplot2)
library(dplyr)

```

# Import data
```{r}
# summaries
observed.summary <- read.csv("ANALYZE-SUMM.observed.csv")
head(observed.summary)
refmodel1.summary<- read.csv("ANALYZE-SUMM.refmodel.csv") # reference model 1
head(refmodel1.summary)
refmodel2.summary<-read.csv("ANALYZE-SUMM.sparse.refmodel.csv") # reference model 2
head(refmodel2.summary)

# reference model strategies
refmodel1.strategies <- read.csv("ANALYZE_SUMM.refmodel.strategies.csv") # observed
str(refmodel1.strategies)
refmodel2.strategies<- read.csv("ANALYZE_SUMM.sparse.refmodel.strategies.csv") %>%
  rename(focus.sparse = focus.Rdisp, 
         position.sparse = position.Rdisp, 
         strategy.sparse = strategy.Rdisp) %>% 
  select(-X)
str(refmodel2.strategies)

ref.model.strategies<-left_join(refmodel1.strategies, refmodel2.strategies, by="run.code")
head(ref.model.strategies)

```

#### Distribution plots

set color and other parameters
```{r}
# set color and other parameters
col.teal <- "#1f78b4" #use for crowds
col.ltgn <- "#b2df8a" #use for sparse displace
col.dkgn <- "#33a02c" #use for regular displace
col.lttl <- "#a6cee3"
col.dkrd <- "#ca0020"


#set color by behavior
crowds <- col.teal
displace <- col.dkgn
obs.vals <- col.dkrd

#set plot color by plot element
bean.alpha <- 0.4


beaninlines <- alpha("black", 0.2)
beanoutlines<- alpha("black", 0.2)
beanavgines <- "purple"
beanborder <- alpha("black", 0.6)

pooled.alpha <- 0.7
linewidth <- 1
xlabels <- c("ref1 crowds", "ref1 displace", "ref2 displace")
obsval.pch <- 5
obsval.size <- 2.5
obsval.hlt.pch <- 8
obsval.hlt.cex <- 1
ylim<-c(0,1)

```



# correlation
```{r, corr.beans, cache=FALSE, fig.height=4, fig.width=5.75}
# correlation
beanplot(refmodel1.summary$run.cor, refmodel2.summary$run.cor, 
         main="Correlation between crowds and displacements", 
         ylab="Spearman's rho", 
         xlab = "reference model", 
         ylim = c(min(refmodel2.summary$run.cor-0.1), 
                  max(0.5)),
         las=1, 
         # col = list(c(alpha(displace, bean.alpha), alpha(col.ltgn, bean.alpha)), #fill colors
         #            c(alpha(beaninlines, 0.5), alpha(beaninlines, 0.5)) #bean colors
         #            ),
         
         col = list(c(alpha(displace, bean.alpha), beaninlines, beaninlines, "black"), #bean 1 
                    c(alpha(col.ltgn, bean.alpha), beaninlines, beaninlines, "black") #bean 2
                    ),
         
         border=crowds
         )

abline(h=observed.summary$obs.cor, col=alpha(obs.vals, pooled.alpha), lwd = linewidth)  # add line estimate of totalDC 

# save plot
dev.print(pdf, file="plot.correlation.beans.pdf")
```

# Hierarchy structure plots combined
The distribution of randomized crowds and displacements (ref model 1) and sparse sampled displacements (ref model 2) with observed values
```{r, hierarchy.beans, cache=FALSE, fig.height=4, fig.width=8.5}
par(mfrow=c(1,3))


# linearity
beanplot(refmodel1.summary$Rcrowd.linearity, refmodel1.summary$Rdisp.linearity, refmodel2.summary$Rdisp.linearity, 
         main="Linearity", 
         ylab="h index", log = "", ylim = ylim,
         xlab = "", names = xlabels, 
         
         #add custom bean colorscrowds
         col = list(c(alpha(crowds, bean.alpha), beaninlines, beaninlines, "black"), #bean 1 
                    c(alpha(displace, bean.alpha), beaninlines, beaninlines, "black"), #bean 2
                    c(alpha(col.ltgn, bean.alpha), beaninlines, beaninlines, "black") #bean 3
                    ), 
        
         border = beanborder, 
         las=1, 
         ll = 0.1, beanlinewd = 2,
         cutmin=0, cutmax=1,
         what = c(FALSE, TRUE, TRUE, TRUE)) # remove overall line

  # add points for observed values
  points(1,observed.summary$Obcrowd.linearity, col= crowds, pch=obsval.pch, cex=obsval.size, lwd=2) # crowds
  points(2,observed.summary$Obdisp.linearity, col= displace, pch=obsval.pch, cex=obsval.size, lwd=2) # displacements
  points(3,observed.summary$Obcrowd.linearity, col= crowds , pch=obsval.pch, cex=obsval.size, lwd=2) # crowds

  points(1,observed.summary$Obcrowd.linearity, col= obs.vals, pch=obsval.hlt.pch, cex=obsval.hlt.cex) # crowds
  points(2,observed.summary$Obdisp.linearity, col= obs.vals, pch=obsval.hlt.pch, cex=obsval.hlt.cex) # displacements
  points(3,observed.summary$Obcrowd.linearity, col= obs.vals , pch=obsval.hlt.pch, cex=obsval.hlt.cex) # crowds

  abline(h=observed.summary$ObtotalCD.linearity, col=alpha(obs.vals, pooled.alpha), lwd = linewidth)  # add line estimate of totalDC 



# steepness
beanplot(refmodel1.summary$Rcrowd.steepness, refmodel1.summary$Rdisp.steepness,refmodel2.summary$Rdisp.steepness,
         main="Steepness", 
         ylab="Dij", las=1, log = "",
         ylim = ylim,
         xlab = "", names = xlabels, 
        
         #add custom bean colorscrowds
         col = list(c(alpha(crowds, bean.alpha), beaninlines, beaninlines, "black"), #bean 1 
                    c(alpha(displace, bean.alpha), beaninlines, beaninlines, "black"), #bean 2
                    c(alpha(col.ltgn, bean.alpha), beaninlines, beaninlines, "black") #bean 3
                    ),         
         
         border = beanborder, las=1, ll = 0.1, beanlinewd = 2,
         cutmin=0, cutmax=1, #so distributions not plotted past 0-1 range
         what = c(FALSE, TRUE, TRUE, TRUE)) # remove overall line

  # add points for observed values

  points(1,observed.summary$Obcrowd.steepness, col=crowds, pch=obsval.pch, cex=obsval.size, lwd=2) # crowds
  points(2,observed.summary$Obdisp.steepness, col=displace, pch=obsval.pch, cex=obsval.size, lwd=2) # displacements
  points(3,observed.summary$Obcrowd.steepness, col= crowds , pch=obsval.pch, cex=obsval.size, lwd=2) # crowds
  
  points(1,observed.summary$Obcrowd.steepness, col=obs.vals, pch=obsval.hlt.pch, cex=obsval.hlt.cex) # crowds
  points(2,observed.summary$Obdisp.steepness, col=obs.vals, pch=obsval.hlt.pch, cex=obsval.hlt.cex) # displacements
  points(3,observed.summary$Obcrowd.steepness, col= obs.vals , pch=obsval.hlt.pch, cex=obsval.hlt.cex) # crowds
  
  abline(h=observed.summary$ObtotalCD.steepness, col=alpha(obs.vals, pooled.alpha), lwd = linewidth)  # add line estimate of totalDC 


# transitivity
beanplot(refmodel1.summary$Rcrowd.transi.ttri, refmodel1.summary$Rdisp.transi.ttri,
         refmodel2.summary$Rdisp.transi.ttri,
         main ="Transitivity", 
         ylab="Triangle motifs",
         ylim= ylim,
         xlab = "", names = xlabels, 
         
         #add custom bean colorscrowds
         col = list(c(alpha(crowds, bean.alpha), beaninlines, beaninlines, "black"), #bean 1 
                    c(alpha(displace, bean.alpha), beaninlines, beaninlines, "black"), #bean 2
                    c(alpha(col.ltgn, bean.alpha), beaninlines, beaninlines, "black") #bean 3
                    ), 
         
         border = beanborder, las=1, ll = 0.1, beanlinewd = 2,
         cutmin=0, cutmax=1,
         what = c(FALSE, TRUE, TRUE, TRUE)) # remove overall line

  # add points for observed values

  points(1,observed.summary$Obcrowd.transi.ttri, col= crowds , pch=obsval.pch, cex=obsval.size, lwd=2) # crowds
  points(2,observed.summary$Obdisp.transi.ttri, col= displace, pch=obsval.pch, cex=obsval.size, lwd=2) # displacements
  points(3,observed.summary$Obcrowd.transi.ttri, col= crowds , pch=obsval.pch, cex=obsval.size, lwd=2) # crowds
  
  points(1,observed.summary$Obcrowd.transi.ttri, col= obs.vals , pch=obsval.hlt.pch, cex=obsval.hlt.cex) # crowds
  points(2,observed.summary$Obdisp.transi.ttri, col= obs.vals, pch=obsval.hlt.pch, cex=obsval.hlt.cex) # displacements
  points(3,observed.summary$Obcrowd.transi.ttri, col= obs.vals , pch=obsval.hlt.pch, cex=obsval.hlt.cex) # crowds
  
  abline(h=observed.summary$ObtotalCD.transi.ttri, col=alpha(obs.vals, pooled.alpha), lwd = linewidth) # add line estimate of totalDC 

# save plot
dev.print(pdf, file="plot.hierarchy.beans.pdf")
  

```

## Network-based measures combined

```{r, network.beans, cache=FALSE, fig.height=4, fig.width=5.75}
par(mfrow=c(1,2))

# density
beanplot(refmodel1.summary$Rcrowd.density, refmodel1.summary$Rdisplace.density, refmodel2.summary$Rdisplace.density,  
         main="Density", 
         ylab="Proportion agonistic relationships", 
         ylim = ylim,
         xlab = "", names = xlabels, 
         
         #add custom bean colorscrowds
         col = list(c(alpha(crowds, bean.alpha), beaninlines, beaninlines, "black"), #bean 1 
                    c(alpha(displace, bean.alpha), beaninlines, beaninlines, "black"), #bean 2
                    c(alpha(col.ltgn, bean.alpha), beaninlines, beaninlines, "black") #bean 3
                    ),          

         border = beanborder, las=1, ll = 0.1, beanlinewd = 2,
         what = c(FALSE, TRUE, TRUE, TRUE)) # remove overall line

  # add points for observed values

  points(1,observed.summary$Obcrowd.density, col= crowds , pch=obsval.pch, cex=obsval.size, lwd=2) # crowds
  points(2,observed.summary$Obdisplace.density, col= displace, pch=obsval.pch, cex=obsval.size, lwd=2) # displacements
  points(3,observed.summary$Obcrowd.density, col= crowds , pch=obsval.pch, cex=obsval.size, lwd=2) # crowds
  
  points(1,observed.summary$Obcrowd.density, col= obs.vals , pch=obsval.hlt.pch, cex=obsval.hlt.cex) # crowds
  points(2,observed.summary$Obdisplace.density, col= obs.vals, pch=obsval.hlt.pch, cex=obsval.hlt.cex) # displacements
  points(3,observed.summary$Obcrowd.density, col= obs.vals , pch=obsval.hlt.pch, cex=obsval.hlt.cex) # crowds
  
  abline(h=observed.summary$ObtotalCD.density, col=alpha(obs.vals, pooled.alpha), lwd = linewidth) # add line estimate of totalDC 

  
# sparseness
beanplot(refmodel1.summary$Rcrowd.prunk.pu, refmodel1.summary$Rdisp.prunk.pu,refmodel2.summary$Rdisp.prunk.pu,
         main ="Sparseness", 
         ylab="Proportion non-interacting dyads", las=1, 
         ylim= ylim,
        xlab = "", names = xlabels, 
        
         #add custom bean colorscrowds
         col = list(c(alpha(crowds, bean.alpha), beaninlines, beaninlines, "black"), #bean 1 
                    c(alpha(displace, bean.alpha), beaninlines, beaninlines, "black"), #bean 2
                    c(alpha(col.ltgn, bean.alpha), beaninlines, beaninlines, "black") #bean 3
                    ),         
         border = beanborder, las=1, ll = 0.1, beanlinewd = 2,
         what = c(FALSE, TRUE, TRUE, TRUE)) # remove overall line

  # add points for observed values

  points(1,observed.summary$Obcrowd.prunk.pu, col= crowds , pch=obsval.pch, cex=obsval.size, lwd=2) # crowds
  points(2,observed.summary$Obdisp.prunk.pu, col= displace, pch=obsval.pch, cex=obsval.size, lwd=2) # displacements
  points(3,observed.summary$Obcrowd.prunk.pu, col= crowds , pch=obsval.pch, cex=obsval.size, lwd=2) # crowds
  
  points(1,observed.summary$Obcrowd.prunk.pu, col= obs.vals , pch=obsval.hlt.pch, cex=obsval.hlt.cex) # crowds
  points(2,observed.summary$Obdisp.prunk.pu, col= obs.vals, pch=obsval.hlt.pch, cex=obsval.hlt.cex) # displacements
  points(3,observed.summary$Obcrowd.prunk.pu, col= obs.vals , pch=obsval.hlt.pch, cex=obsval.hlt.cex) # crowds
  
  abline(h=observed.summary$ObtotalCD.prunk.pu, col=alpha(obs.vals, pooled.alpha), lwd = linewidth) # add line estimate of totalDC 
  

# save plot
dev.print(pdf, file="plot.network.beans.pdf")
```



## Aggression strategies
summary of number of runs per strategy and plot those with observed strategie in caption

```{r, network.beans, cache=FALSE, fig.height=4, fig.width=5.75}
# observed strategies
observed.summary$strategy.Obcrowd # "pure bully"
observed.summary$strategy.Obdisp  # "pure bully"
observed.summary$Obstrategy.totalCD # "pure bully"


# strategies per random run
strategies.Rcrowd<-group_by(ref.model.strategies, strategy.Rcrowd) %>%
  tally() %>% 
  mutate(behavior="crowd") %>%
  rename(strategy=strategy.Rcrowd) %>%
  add_row(strategy="close.competitor",n= 0, behavior="crowd")
strategies.Rdisp<-group_by(ref.model.strategies, strategy.Rdisp) %>%
  summarise(n=n()) %>% 
  mutate(behavior="displace") %>%
  rename(strategy=strategy.Rdisp) %>%
  add_row(strategy="close.competitor",n= 0, behavior="displace")
strategies.sparse<-group_by(ref.model.strategies, strategy.sparse) %>%
  summarise(n=n()) %>% 
  mutate(behavior="sparse displace") %>%
  rename(strategy=strategy.sparse) %>%
  add_row(strategy="close.competitor",n= 0, behavior="sparse displace")
strategies<-rbind(strategies.Rcrowd, strategies.Rdisp, strategies.sparse)

strategies$strategy<-factor(strategies$strategy, 
                            levels =c("downward.heuristic","close.competitor","pure.bully", "pure.undefined") , 
                            labels = c("Downward heuristic", "Close competitors", "Bullying", "Undefined") )

strategies$behavior<-factor(strategies$behavior, 
                            levels = c("crowd", "displace", "sparse displace"),
                            labels = c("ref1 crowds", "ref1 displace", "ref2 displace"))

ggplot(strategies, aes(x=behavior, y=n, fill=strategy)) +
  geom_col(aes(group= strategy), colour= beanborder) +
  theme_classic() +
  labs(y="percentage", x="", caption = "observed crowd = bullying \nobserved displace = bullying \nobserved pooled = bullying") +
  theme(plot.caption=element_text(hjust = 0) ) +
  scale_fill_manual(values=c(alpha("lightgrey", 0.4),alpha("red", 0.4), alpha("blue", 0.4), alpha("black", 0.6)))  


# save plot
dev.print(pdf, file="plot.strategies.pdf")
```



# sessioninfo
```{r}
sessionInfo()
```
