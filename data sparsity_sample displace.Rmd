---
title: 'data sparsity: sample displace'
author: "Annemarie"
date: "09/06/2020"
output: html_document
---

Load packages
```{r}
library(dplyr)
library(tidyr)
library(reshape2)
```

## import data

```{r}
# TO TEST/EXPLORE scripts/analyses:
EXPLORE_perpre_aggCD <- read.csv(file="EXPLORE-perpre-aggCD.csv") 
observed <- EXPLORE_perpre_aggCD %>%
  rename(rowID=X) # only necessary if the first column is an X

# FINAL ANALYSIS:
#ANALYZE_per0_aggCD <- read.csv(file="ANALYZE-per0-aggCD.csv") # final analyses
#agg.data <- subset(ANALYZE_per0_aggDC, days=="last") #this is the ANALYZE data for the actual analyses in the final paper
#observed <- agg.data

head(observed)
str(observed)

```


We require a list of all behaviors, thus we will have to add the behaviors with n>1 as separate rows.

## displacements in long format
code from:
https://stackoverflow.com/questions/2894775/repeat-each-row-of-data-frame-the-number-of-times-specified-in-a-column
```{r}
aggD.long<-select(observed, -crowd, -total.DC) %>%
  slice(rep(seq_len(n()), displace)) %>% 
  select(-displace)

# check # observations correct
length(aggD.long$rowID)
sum(observed$displace)
```

## sample displacements
To get the same sparse dataset as for crowds, we randomly select the number of displacements
```{r}
sum(observed$crowd)  # 56 crowds

RNGkind(sample.kind="default") 
set.seed(42)
sample.aggD <- sample_n(aggD.long, size = 56, replace = FALSE)

head(sample.aggD)
length(sample.aggD$rowID)
```

## summarize displacements

```{r}
#finds n disps per actor by date for trimmed data
sample.aggDXday <- sample.aggD %>% 
  group_by(actor, subject, date) %>% 
  summarise(n=n())  %>%
  mutate(behavior="displace")
head(sample.aggDXday)
sum(sample.aggDXday$n)
```


## combine crowd and displace data
```{r}
obs.crowd<- observed %>%
  select(actor, subject, date, crowd) %>%
  rename(n=crowd) %>%
  mutate(behavior="crowd") %>%
  filter(n!=0) %>%
  ungroup()
head(obs.crowd)   
length(obs.crowd$actor)

sample.obs.CD<-bind_rows(obs.crowd, sample.aggDXday) 
head(sample.obs.CD)
str(sample.obs.CD)

```

## from long to wide format
cast number of aggressions per day by behavior type

```{r}
sample.obs.CD.wide <- sample.obs.CD %>% pivot_wider(names_from = "behavior", 
  values_from = "n",
  values_fill = list(n = 0)) %>%
  mutate(total.DC=displace + crowd)
head(sample.obs.CD.wide)
```


## Export file
```{r}
write.csv(sample.obs.CD.wide, file = "EXPLORE-sample-aggCD.csv")
```

